!function(e){function t(s){if(a[s])return a[s].exports;var i=a[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,t,a){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=331)}({135:function(e,t,a){!function(t,a){e.exports=a()}(this,function(){return function(e){function t(s){if(a[s])return a[s].exports;var i=a[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,t,a){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),i=function(){function e(){a(this,e),this.amount=0,this.averageRange=0,this.count=0,this.rangeSum=0,this.backstabCount=0,this.headshotCount=0,this.meleeBlockCount=0,this.rangeBlockCount=0,this.rangeBlockAmount=0}return s(e,[{key:"addDamage",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments[1];t.isBlocked||(this.count++,this.amount+=e),this.rangeSum+=t.range,this.count>0&&(this.averageRange=this.rangeSum/this.count),t.isBackstab&&this.backstabCount++,t.isHeadshot&&this.headshotCount++,t.isBlocked&&(t.isRanged?(this.rangeBlockAmount+=e*(t.block/100),this.rangeBlockCount++):this.meleeBlockCount++)}},{key:"addOtherSubSummary",value:function(t){var a=new e;return a.amount=this.amount+t.amount,a.count=this.count+t.count,this.count>0||t.count>0?a.averageRange=(this.rangeSum+t.rangeSum)/(this.count+t.count):a.averageRange=0,a.backstabCount=this.backstabCount+t.backstabCount,a.headshotCount=this.headshotCount+t.headshotCount,a.meleeBlockCount=this.meleeBlockCount+t.meleeBlockCount,a.rangeBlockAmount=this.rangeBlockAmount+t.rangeBlockAmount,a.rangeBlockCount=this.rangeBlockCount+t.rangeBlockCount,a.rangeSum=this.rangeSum+t.rangeSum,a}}]),e}(),n=function(){function e(){a(this,e),this.summaries={afk:{dealt:new i,received:new i},melee:{dealt:new i,received:new i},ranged:{dealt:new i,received:new i}}}return s(e,[{key:"add",value:function(e){var t=this.summaries.melee;e.isRanged&&(t=e.isAFK?this.summaries.afk:this.summaries.ranged);var a=t.dealt,s=e.dealt;e.isReceived&&(a=t.received,s=e.received),a.addDamage(s,e)}},{key:"addOtherSummary",value:function(t){var a=new e;return a.summaries={afk:{dealt:this.summaries.afk.dealt.addOtherSubSummary(t.summaries.afk.dealt),received:this.summaries.afk.received.addOtherSubSummary(t.summaries.afk.received)},melee:{dealt:this.summaries.melee.dealt.addOtherSubSummary(t.summaries.melee.dealt),received:this.summaries.melee.received.addOtherSubSummary(t.summaries.melee.received)},ranged:{dealt:this.summaries.ranged.dealt.addOtherSubSummary(t.summaries.ranged.dealt),received:this.summaries.ranged.received.addOtherSubSummary(t.summaries.ranged.received)}},a}},{key:"getSummary",value:function(){var e=this.summaries.melee.dealt.addOtherSubSummary(this.summaries.ranged.dealt);e=e.addOtherSubSummary(this.summaries.afk.dealt);var t=this.summaries.melee.received.addOtherSubSummary(this.summaries.ranged.received);t=t.addOtherSubSummary(this.summaries.afk.received);var a=e.count+t.count,s=e.rangeSum+t.rangeSum,i=Object.assign({},this.summaries,{averageRange:s/a},{dealt:e,received:t});return i}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t){"use strict";function a(e){return s.indexOf(e)!==-1}var s=["eu","us-east","us-west","ocn"];t.isRegionsType=a},function(e,t,a){"use strict";function s(e){var t=arguments.length<=1||void 0===arguments[1]?{ignoreBots:!1,includeEntries:!1}:arguments[1],a=[],s={end:new Date,entries:[],games:[],meta:{errors:[],lines:{relevant:0,total:0},version:0,warnings:[]},players:{},start:new Date,summary:{damage:new i["default"],deaths:0,kills:0,losses:0,wins:0}},u=!1,l=new r["default"],m="",d=e.split("\n");return d.forEach(function(e,h){s.meta.lines.total++;var c=new n["default"](e);if(a.indexOf(c.moduleName)===-1&&a.push(c.moduleName),c.parse(t),!u&&c.date&&(u=!0,s.start=c.date),c.date&&(s.end=c.date),c.interesting)if(s.meta.lines.relevant++,c.isGameStart&&(l=new r["default"]),0===c.version.api){if(""===c.version.game){if(0===s.meta.version&&c.isGameStart){var g="Parsed log file does not appear to have a recognized version line.";s.meta.warnings.indexOf(g)===-1&&s.meta.warnings.push(g)}if(c.region&&(m=c.region),l.addEntry(c),!c.isGameEnd&&!l.type||"unknown"===l.type||"bot"===l.type)return void("bot"===l.type||c.isGameStart||c.isGameEnd||c.region||s.meta.warnings.push("Unknown game type, ignoring possibly interesting entry. Gametype: "+l.type+", Entry: "+JSON.stringify(c)+"."));if(c.isKill&&s.summary.kills++,c.isDeath&&s.summary.deaths++,c.isWin&&s.summary.wins++,c.isLoss&&s.summary.losses++,c.damage.isBlocked&&c.damage.isBackstab&&s.meta.warnings.push("Someone blocked a backstab?!?!?!?!"),c.damage.isBlocked&&c.damage.isAFK&&(console.info("culling-log-parser: "),s.meta.warnings.push("Someone blocked a damage instance from stupid range.\n      Rare but can happen, just wanted to let you know.")),s.summary.damage.add(c.damage),l.isFinished){var f=l.getResult();Object.keys(f.players).forEach(function(e){s.players[e]||(s.players[e]={damage:new i["default"],timesMet:0}),s.players[e].damage=s.players[e].damage.addOtherSummary(l.players[e]),s.players[e].timesMet++}),s.games.push(f),l=new r["default"](m)}t.includeEntries&&s.entries&&s.entries.push(c),h>d.length&&console.error("lineno over lines length"),h===d.length&&l.start&&!l.isFinished&&(l.finish(c),s.games.push(l.getResult()))}}else{if(s.meta.version=c.version.api,c.version.api<92253){var y="Parsed old log file that is known to not have kills or deaths.";s.meta.warnings.indexOf(y)===-1&&s.meta.warnings.push(y)}if(!o.indexOf(c.version.api)){var p="Parsed log file that is not from an API Version that is verified: "+c.version.api;s.meta.warnings.indexOf(p)===-1&&s.meta.warnings.push(p)}}}),o.indexOf(s.meta.version)!==-1&&s.summary.damage.getSummary().dealt.amount>100&&0===s.summary.kills&&console.log("No kills found in version",s.meta.version,s.summary.damage.getSummary().dealt.amount,s.summary.wins,s.summary.losses,s.summary.deaths,s.start),s.meta.version<92253&&s.summary.kills>0&&console.log("Old version that *does* have kills",s.meta.version),s}var i=a(0),n=a(5),r=a(4),o=[92253,92358,92449,92896,93315,93811];Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=s},function(e,t){"use strict";function a(e){var t={entries:e.entries||[],games:e.games,meta:e.meta,players:{},summary:{damage:e.summary.damage.getSummary(),deaths:e.summary.deaths,kills:e.summary.kills,losses:e.summary.losses,wins:e.summary.wins}};return Object.keys(e.players).forEach(function(a){t.players[a]={damage:e.players[a].damage.getSummary(),timesMet:e.players[a].timesMet}}),t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a},function(e,t,a){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),n=a(0),r=Date.now(),o=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];s(this,e),this.id=++r,this.start=null,this.end=null,this.players={},this.damageSummary=new n["default"],this.damageInstances=[],this.kills=0,this.isWin=!1,this.isLoss=!1,this.isFinished=!1,this.deathWaitingForDamage=!1,this.type="",this.region=t,this.isBotGame=!0}return i(e,[{key:"addEntry",value:function(e){e.isGameStart&&(this.start=e.date||new Date),this.addDamage(e),""!==e.gameType.game&&(this.type=e.gameType.game),e.region&&(this.region=e.region),e.isKill&&this.kills++,this.deathWaitingForDamage&&e.damage.isReceived?this.finish(e):e.isWin?this.isWin=!0:this.isWin===!1&&e.isDeath||e.isLoss?(this.isLoss=!0,this.deathWaitingForDamage=!0):this.start&&e.isGameEnd&&this.finish(e)}},{key:"addDamage",value:function(e){(e.damage.dealt||e.damage.received||e.damage.isBlocked)&&(this.damageSummary.add(e.damage),this.players[e.otherPlayer]||(this.players[e.otherPlayer]=new n["default"]),this.players[e.otherPlayer].add(e.damage),this.damageInstances.push(Object.assign({name:e.otherPlayer},e.damage)))}},{key:"finish",value:function(e){e.date&&(this.end=e.date),isNaN(e.score)||(this.score=e.score),this.isFinished=!0}},{key:"getResult",value:function(){var e=Object.keys(this.players),t={},a=!0,s=!1,i=void 0;try{for(var n,r=e[Symbol.iterator]();!(a=(n=r.next()).done);a=!0){var o=n.value;t[o]={damage:this.players[o].getSummary(),died:!1,killed:!1}}}catch(u){s=!0,i=u}finally{try{!a&&r["return"]&&r["return"]()}finally{if(s)throw i}}return{damageInstances:this.damageInstances,damageSummary:this.damageSummary.getSummary(),end:this.end||new Date(0),id:this.id,isLoss:this.isLoss,isWin:this.isWin,kills:this.kills,mode:this.type,players:t,region:this.region,score:this.score,start:this.start||new Date(0)}}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o},function(e,t,a){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),n=a(1),r={"VictoryGameMode_Solo.VictoryGameMode_Solo_C":"solo","VictoryGameMode.VictoryGameMode_C":"team","VictoryGameMode_Lightning.VictoryGameMode_Lightning_C":"lightning","VictoryGameMode_Custom.VictoryGameMode_Custom_C":"custom","VictoryGameMode_TrialsSolo.VictoryGameMode_TrialsSolo_C":"trials"},o=function(){function e(t){s(this,e),this.fullLine=t,this.damage={block:0,dealt:0,isAFK:!1,isBackstab:!1,isBlocked:!1,isDealt:!0,isHeadshot:!1,isRanged:!1,isReceived:!1,range:0,received:0,timestamp:0},this.isGameStart=!1,this.isGameEnd=!1,this.isWin=!1,this.isLoss=!1,this.otherPlayer="",this.isKill=!1,this.isDeath=!1,this.score=0,this.region="",this.version={api:0,game:""},this.gameType={game:"",level:""},this.interesting=!1,this.date=this.parseDate(),this.moduleName=this.parseModuleName()}return i(e,[{key:"parse",value:function(e){this.parseVersion(),this.parseRegion(),this.parseGameState(),this.parseGameType(),this.parseIsBotGame(),this.parseDamage(e.ignoreBots),this.parseRankScoring()}},{key:"parseDate",value:function(){if(!this.fullLine.match(/^\[[\d\.\-:]+]/))return null;var e=this.fullLine.substr(1,4),t=this.fullLine.substr(6,2),a=this.fullLine.substr(9,2),s=this.fullLine.substr(12,2),i=this.fullLine.substr(15,2),n=this.fullLine.substr(18,2),r=this.fullLine.substr(21,3);return new Date(e+"-"+t+"-"+a+"T"+s+":"+i+":"+n+"."+r+"Z")}},{key:"parseModuleName",value:function(){var e=this.fullLine;this.date&&(e=e.substr(30));var t=e.match(/^[^\s]+/);if(!t)return"NoModuleFound";var a=t[0].replace(/:$/,"");return a}},{key:"parseVersion",value:function(){if("LogInit"===this.moduleName){var e=this.fullLine.substr(9);this.date&&(e=this.fullLine.substr(39)),0===e.indexOf("Version:")?(this.version.game=e.substr(18),this.interesting=!0):0===e.indexOf("API Version:")&&(this.version.api=parseInt(e.substr(13),10),this.interesting=!0)}}},{key:"parseRegion",value:function(){if("FrontEnd:Display"===this.moduleName){var e=this.fullLine.substr(48),t=e.match(/appid is [\d]+, using url https?:\/\/clientweb-([^\.]+).theculling.net\/api/i);if(t){this.interesting=!0;var a=t[1];n.isRegionsType(a)?this.region=a:this.region="unknown"}}}},{key:"parseGameState",value:function(){if("LogOnline"===this.moduleName){var e=this.fullLine.substr(41);e.indexOf("GotoState: NewState: Playing")!==-1?(this.interesting=!0,this.isGameStart=!0):e.indexOf("GotoState: NewState: MainMenu")!==-1&&(this.isGameEnd=!0,this.interesting=!0)}}},{key:"parseGameType",value:function(){if("LogNet"===this.moduleName){var e=this.fullLine.substr(38);if(e.indexOf("Welcomed by server")!==-1){var t=e.match(/\(Level: \/Game\/Maps\/([^,]+), Game: \/Game\/Blueprints\/GameMode\/([^\)]+)\)/i);if(!t)return void console.warn("culling-log-parser: WARNING! Found a server welcome that didn't match expected format",this.fullLine);this.interesting=!0;var a=r[t[2]];a||(console.warn("culling-log-parser: WARNING! Found an unknown game mode.",t[2],this.fullLine),a="unknown"),this.gameType={game:a,level:t[1]}}}}},{key:"parseIsBotGame",value:function(){if("LogLoad"===this.moduleName){var e=this.fullLine.substr(38);e.match(/LoadMap: (?:[\d\.]+)?\/?\/Game\/Maps\/(?:Tutorial|Jungle\/Jungle_P\?bEnableBots)/i)&&(this.gameType.game="bot",this.interesting=!0)}}},{key:"parseDamage",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if("VictoryDamage:Display"===this.moduleName){var t=this.fullLine.substr(53),a=t.match(/You hit (.*) for (-?[\d\.]+) damage \(([\d\.]+)\ m\)/i);if(a||(this.damage.isDealt=!1,this.damage.isReceived=!0,a=t.match(/Struck by (.*) for (-?[\d\.]+) damage \(([\d\.]+)\ m\)/i)),!a)return void console.error("VictoryDamage:Display with wrong format",t);if(this.interesting=!0,this.otherPlayer=a[1],e&&this.otherPlayer.match(/<BOT>[\d]-[A-F0-9]{32}/))return void(this.interesting=!1);this.date&&(this.damage.timestamp=this.date.getTime());var s=parseInt(a[2],10);this.damage.isDealt?this.damage.dealt=s:this.damage.received=s,this.damage.range=parseInt(a[3],10),this.damage.range>3&&(this.damage.isRanged=!0,this.damage.range>300&&(this.damage.isAFK=!0));var i=t.match(/BLOCKED ([\d]+)%/i);i&&(this.damage.isBlocked=!0,this.damage.block=parseInt(i[1],10),50===this.damage.block?this.damage.isRanged=!0:100!==this.damage.block&&25!==this.damage.block&&console.info("culling-log-parser: Found abnormal block value!",i[1],this.fullLine)),t.match("BACKSTAB!")&&(this.damage.isBackstab=!0),t.match("HEADSHOT!")&&(this.damage.isHeadshot=!0)}}},{key:"parseRankScoring",value:function(){if("LogOnline:Warning"===this.moduleName){var e=this.fullLine.substr(49),t=e.match(/RankScoring (win|loss|kill|death): (-?[\d]+)/i);if(t)switch(this.interesting=!0,this.score=parseInt(t[2],10),t[1]){case"win":this.isWin=!0;break;case"loss":this.isLoss=!0;break;case"kill":this.isKill=!0;break;case"death":this.isDeath=!0;break;default:console.error("Found unknown RankScoring value:"+e)}}}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o},function(e,t,a){"use strict";var s=a(2),i=a(0);t.DamageSummary=i["default"];var n=a(3);t.makeCloneable=n["default"];var r=a(1);t.ICullingParser=r,Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=s["default"]}])})},137:function(e,t){"use strict";function a(e,t){return"asc"===t?e:e*-1}function s(e,t){var s=arguments.length<=2||void 0===arguments[2]?"asc":arguments[2],i=e.start.getTime()-t.start.getTime();return a(i,s)}function i(e,t){t.forEach(function(t){return e.push(t)})}t.sortGamesByStart=s,t.fastConcat=i},331:function(e,t,a){"use strict";function s(){var e=100-o;return o+=.01*e}function i(e,t,a,i){var r=new FileReader;r.readAsText(e),r.onprogress=function(e){var a=0;e.lengthComputable?a=e.loaded/e.total*100:(console.log("Faking progress"),a=s()),a/=2,t.call(r,a)},r.onload=function(e){var t=void 0;try{t=n["default"](r.result,{ignoreBots:!0})}catch(s){return void i.call(r,s)}a.call(r,t)},r.onerror=i}var n=a(135),r=a(137),o=0;onmessage=function(e){var t=e.data,a={end:new Date(0),games:[],highestDamageEntry:{},meta:{errors:[],lines:{relevant:0,total:0},version:0,warnings:[]},players:{},start:new Date,summary:{damage:new n.DamageSummary,deaths:0,kills:0,losses:0,wins:0}},s=function o(e){var s=e/t.length*100;i(t[e],function(e){postMessage({progress:s+e/t.length,type:"progress"})},function(s){try{s.start<a.start&&(a.start=s.start),s.end>a.end&&(a.end=s.end),postMessage({games:s.games,type:"games"}),a.meta.lines.relevant+=s.meta.lines.relevant,a.meta.lines.total+=s.meta.lines.total,Object.keys(s.players).forEach(function(e){var t=a.players[e];t?(t.damage=t.damage.addOtherSummary(s.players[e].damage),t.timesMet+=s.players[e].timesMet):a.players[e]=t=s.players[e]}),a.summary.damage=a.summary.damage.addOtherSummary(s.summary.damage),a.summary.deaths+=s.summary.deaths,a.summary.kills+=s.summary.kills,a.summary.losses+=s.summary.losses,a.summary.wins+=s.summary.wins,r.fastConcat(a.meta.errors,s.meta.errors),r.fastConcat(a.meta.warnings,s.meta.warnings),e++,t[e]?o(e):postMessage({output:n.makeCloneable(a),type:"done"})}catch(i){postMessage({error:i.message,stack:i.stack,type:"error"})}},function(e){console.log("Posting error"),postMessage({error:e.message,stack:e.stack,type:"error"})})};s(0),postMessage({type:"started"})}}});
//# sourceMappingURL=worker.js.map